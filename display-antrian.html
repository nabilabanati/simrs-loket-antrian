<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RSUD Slawi - Informasi Antrian</title>
    <link rel="stylesheet" href="/src/css/variants.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Smooth transitions for queue updates */
      .transition-all {
        transition: all 0.3s ease-in-out;
      }
      
      /* Pulse animation for active loket */
      @keyframes pulse-ring {
        0% {
          transform: scale(0.8);
          opacity: 1;
        }
        100% {
          transform: scale(1.2);
          opacity: 0;
        }
      }
      
      .ring-pulse {
        animation: pulse-ring 2s infinite;
      }
      
      /* Enhanced marquee */
      .marquee {
        animation: marquee 30s linear infinite;
      }
      
      @keyframes marquee {
        from { transform: translateX(100%); }
        to { transform: translateX(-100%); }
      }
    </style>
  </head>
  <body class="bg-gray-100 font-inter">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-5 shadow-lg">
      <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center space-x-3">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-8 h-8 text-white"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Z"
            />
          </svg>
          <h1 class="text-2xl font-bold">RSUD SLAWI</h1>
        </div>
        <div class="text-right">
          <div class="flex items-center space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="size-5"
            >
              <path
                fill-rule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z"
                clip-rule="evenodd"
              />
            </svg>
            <span id="current-time" class="text-lg font-semibold"
              >10:09:12</span
            >
          </div>
          <div id="current-date" class="text-sm opacity-90">
            Kamis, 10 Juli 2025
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4">
      <!-- Top Section -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
        <!-- Queue Info Card -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="bg-teal-600 text-white p-4">
            <h2 class="text-xl font-bold text-center">
              INFORMASI ANTRIAN PASIEN
            </h2>
          </div>
          <div class="p-8 text-center">
            <div
              id="current-queue"
              class="text-8xl font-black text-gray-800 mb-6"
            >
              001
            </div>
            <h3 class="text-2xl font-bold text-gray-800">
              MENUJU LOKET <span id="next-loket" class="text-teal-600">1</span>
            </h3>
          </div>
        </div>

        <!-- Hospital Image -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <img
            src="/src/img/foto-display.jpg"
            alt="Medical Team"
            class="h-full w-full object-cover"
          />
        </div>
      </div>

      <!-- Counter Cards -->
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="bg-teal-600 text-white p-3 text-center">
            <h3 class="font-bold">Loket 1</h3>
          </div>
          <div class="p-6 text-center">
            <div id="loket1" class="text-4xl font-black text-gray-800">000</div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="bg-teal-600 text-white p-3 text-center">
            <h3 class="font-bold">Loket 2</h3>
          </div>
          <div class="p-6 text-center">
            <div id="loket2" class="text-4xl font-black text-gray-800">000</div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="bg-teal-600 text-white p-3 text-center">
            <h3 class="font-bold">Loket 3</h3>
          </div>
          <div class="p-6 text-center">
            <div id="loket3" class="text-4xl font-black text-gray-800">000</div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="bg-teal-600 text-white p-3 text-center">
            <h3 class="font-bold">Loket 4</h3>
          </div>
          <div class="p-6 text-center">
            <div id="loket4" class="text-4xl font-black text-gray-800">000</div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="bg-teal-600 text-white p-3 text-center">
            <h3 class="font-bold">Loket 5</h3>
          </div>
          <div class="p-6 text-center">
            <div id="loket5" class="text-4xl font-black text-gray-800">000</div>
          </div>
        </div>
      </div>

      <!-- Footer Message dengan Animasi -->
      <div class="bg-blue-200 rounded-lg overflow-hidden marquee-container">
        <div class="py-4">
          <p class="text-gray-800 font-medium text-lg marquee">
            Selamat datang di RSUD Slawi - Kami siap melayani Anda dengan
            sepenuh hati - Mohon tunggu panggilan antrian Anda - Terima kasih
            atas kesabaran Anda
          </p>
        </div>
      </div>
    </main>

    <script>
      // Queue Information System
      class QueueInfoSystem {
        constructor() {
          this.currentQueue = parseInt(localStorage.getItem("currentQueue")) || 1;
          this.loketQueues = JSON.parse(localStorage.getItem("loketData")) || {
            1: { status: 'active', currentNumber: 0, remaining: 0 },
            2: { status: 'active', currentNumber: 0, remaining: 0 },
            3: { status: 'active', currentNumber: 0, remaining: 0 },
            4: { status: 'active', currentNumber: 0, remaining: 0 },
            5: { status: 'active', currentNumber: 0, remaining: 0 }
          };
          this.currentLoket = 1;
          this.init();
        }

        init() {
          this.updateDisplay();
          this.updateTime();
          this.setupEventListeners();
          this.loadVoices();

          // Update time every second
          setInterval(() => this.updateTime(), 1000);
          
          // Check for updates every 2 seconds
          setInterval(() => this.checkForUpdates(), 2000);
        }

        loadVoices() {
          // Load voices when available
          if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {
              this.voices = speechSynthesis.getVoices();
            };
          }
        }

        setupEventListeners() {
          // Listen for queue updates from dashboard
          window.addEventListener("storage", (e) => {
            if (e.key === "queueUpdate") {
              this.handleQueueUpdate(e.newValue);
            } else if (e.key === "currentQueue" || e.key === "loketData") {
              this.checkForUpdates();
            }
          });
        }

        handleQueueUpdate(data) {
          if (data) {
            try {
              const updateInfo = JSON.parse(data);
              const oldQueue = this.currentQueue;
              
              this.currentQueue = updateInfo.currentNumber;
              this.currentLoket = updateInfo.loket;
              
              if (updateInfo.loketData) {
                this.loketQueues = updateInfo.loketData;
              }
              
              this.updateDisplay();
              
              // Play announcement if queue number changed
              if (oldQueue !== this.currentQueue) {
                this.playAnnouncement();
              }
            } catch (error) {
              console.error("Error parsing queue update:", error);
            }
          }
        }

        checkForUpdates() {
          const storedQueue = parseInt(localStorage.getItem("currentQueue"));
          const storedLoketData = JSON.parse(localStorage.getItem("loketData"));

          let hasUpdate = false;

          if (storedQueue && storedQueue !== this.currentQueue) {
            this.currentQueue = storedQueue;
            hasUpdate = true;
          }

          if (storedLoketData) {
            this.loketQueues = storedLoketData;
            hasUpdate = true;
          }

          if (hasUpdate) {
            this.updateDisplay();
          }
        }

        updateDisplay() {
          // Update main queue display
          const currentQueueElement = document.getElementById("current-queue");
          if (currentQueueElement) {
            currentQueueElement.textContent = String(this.currentQueue).padStart(3, "0");
          }

          // Find target loket (the one with current queue number)
          let targetLoket = 1;
          Object.entries(this.loketQueues).forEach(([loket, data]) => {
            const loketNum = parseInt(loket);
            if (data.currentNumber === this.currentQueue) {
              targetLoket = loketNum;
            }
          });

          const nextLoketElement = document.getElementById("next-loket");
          if (nextLoketElement) {
            nextLoketElement.textContent = targetLoket;
          }

          // Update individual loket displays
          for (let i = 1; i <= 5; i++) {
            const loketElement = document.getElementById(`loket${i}`);
            if (loketElement && this.loketQueues[i]) {
              const queueNumber = this.loketQueues[i].currentNumber || 0;
              loketElement.textContent = String(queueNumber).padStart(3, "0");
              
              // Add highlight effect for current active loket
              const loketCard = loketElement.closest('.bg-white');
              if (loketCard) {
                if (i === targetLoket && queueNumber === this.currentQueue) {
                  loketCard.classList.add('ring-4', 'ring-teal-500', 'ring-opacity-50');
                } else {
                  loketCard.classList.remove('ring-4', 'ring-teal-500', 'ring-opacity-50');
                }
              }
            }
          }
        }

        playAnnouncement() {
          if ('speechSynthesis' in window) {
            // Stop any current speech
            window.speechSynthesis.cancel();
            
            const speech = new SpeechSynthesisUtterance(
              `Nomor antrian ${this.currentQueue}, silakan menuju loket ${this.currentLoket}`
            );
            
            speech.lang = 'id-ID';
            speech.rate = 0.8;
            speech.pitch = 1;
            speech.volume = 1;
            
            // Use Indonesian voice if available
            if (this.voices) {
              const indonesianVoice = this.voices.find(voice => 
                voice.lang.includes('id') || 
                voice.name.toLowerCase().includes('indo')
              );
              if (indonesianVoice) {
                speech.voice = indonesianVoice;
              }
            }
            
            speech.onerror = function(event) {
              console.error('Speech synthesis error:', event.error);
            };
            
            // Speak with delay
            setTimeout(() => {
              window.speechSynthesis.speak(speech);
            }, 200);
          }
        }

        updateTime() {
          const now = new Date();
          const timeString = now.toLocaleTimeString("id-ID", {
            hour12: false,
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
          const dateString = now.toLocaleDateString("id-ID", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          const timeElement = document.getElementById("current-time");
          const dateElement = document.getElementById("current-date");
          
          if (timeElement) timeElement.textContent = timeString;
          if (dateElement) dateElement.textContent = dateString;
        }
      }

      // Initialize the system
      document.addEventListener("DOMContentLoaded", () => {
        new QueueInfoSystem();
      });
    </script>
  </body>
</html>
